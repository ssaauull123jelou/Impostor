<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Juego del Impostor</title>

<style>
body{
    margin:0;
    font-family:'Segoe UI',sans-serif;
    background:#2e2e2e;
    color:white;
    text-align:center;
}

h1{margin:25px 0;}

.card{
    background:#141414;
    border-radius:20px;
    padding:30px;
    max-width:420px;
    margin:25px auto;
    box-shadow:0 0 20px rgba(0,0,0,.5);
    animation:fade .4s ease;
}

@keyframes fade{
    from{opacity:0;transform:scale(.95)}
    to{opacity:1;transform:scale(1)}
}

label{display:block;margin-top:15px;font-size:18px;font-weight:bold}
input,select,textarea{
    width:80%;
    padding:12px;
    border-radius:10px;
    border:none;
    margin-top:8px;
    font-size:16px;
}

.player-name-input{
    width:80%;
    padding:12px;
    border-radius:10px;
    border:none;
    margin:8px 0;
    font-size:16px;
}

.custom-words{
    width:80%;
    height:120px;
    padding:12px;
    border-radius:10px;
    border:none;
    margin-top:8px;
    font-size:16px;
    resize:vertical;
}

button{
    background:linear-gradient(135deg,#ff0033,#ff6600);
    border:none;
    border-radius:30px;
    padding:15px 35px;
    color:white;
    font-size:18px;
    font-weight:bold;
    cursor:pointer;
    margin-top:20px;
    transition:.15s;
}
button:hover{transform:scale(1.05)}

.hidden{display:none}

.big{font-size:34px;font-weight:bold;margin:20px 0}
.impostor{color:#ff3b3b}
.lost{color:#ffd700}
.word{color:#4cff4c}

/* GRID */
.grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(120px,1fr));
    gap:15px;
}
.player-box{
    background:#1e1e1e;
    border-radius:15px;
    padding:20px;
    cursor:pointer;
    transition:.2s;
}
.player-box:hover{transform:scale(1.05);background:#2a2a2a}
.ready{opacity:.5;cursor:default}

/* FLIP CARD */
.flip-container{perspective:1000px;margin:25px 0}
.flip-card{
    height:160px;
    transform-style:preserve-3d;
    transition:.6s;
}
.flip-card.flipped{transform:rotateY(180deg)}
.flip-face{
    position:absolute;
    width:100%;
    height:160px;
    backface-visibility:hidden;
    display:flex;
    align-items:center;
    justify-content:center;
    border-radius:20px;
    font-size:30px;
    font-weight:bold;
}
.front{background:#1e1e1e}
.back{background:#000;transform:rotateY(180deg)}

/* FIRMA */
.signature{
    position:fixed;
    bottom:10px;
    right:15px;
    font-size:13px;
    opacity:.6;
    pointer-events:none;
}

.player-names-container{
    max-height:300px;
    overflow-y:auto;
    margin-top:15px;
    padding:10px;
    background:#1a1a1a;
    border-radius:10px;
}

.custom-category-container{
    margin-top:15px;
}
</style>
</head>

<body>

<h1>üïµÔ∏è Juego del Impostor</h1>

<!-- CONFIG -->
<div id="step1" class="card">
    <label>Jugadores</label>
    <input type="number" id="players" min="3" max="30" value="6" onchange="updatePlayerNameInputs()">
    <div class="player-names-container" id="playerNamesContainer">
        <!-- Player name inputs will be generated here -->
    </div>
    <label>Impostores</label>
    <input type="number" id="impostors" min="1" value="1" onchange="validateConfig()">
    <label>Perdidos</label>
    <input type="number" id="lost" min="0" max="30" value="0" onchange="validateConfig()">
    <button onclick="goStep2()">Continuar</button>
</div>

<!-- CATEGORIA -->
<div id="step2" class="card hidden">
    <label>Categor√≠a</label>
    <select id="category" onchange="toggleCustomInput()">
        <option value="marcas">Marcas</option>
        <option value="paises">Pa√≠ses</option>
        <option value="objetos">Objetos</option>
        <option value="animales">Animales</option>
        <option value="comidas">Comidas</option>
        <option value="profesiones">Profesiones</option>
        <option value="ciudades">Ciudades</option>
        <option value="videojuegos">Videojuegos</option>
        <option value="custom">Personalizada</option>
    </select>
    
    <div id="customCategoryContainer" class="custom-category-container hidden">
        <label>Palabras personalizadas</label>
        <textarea id="customWords" class="custom-words" placeholder="Escribe 20 palabras separadas por comas o saltos de l√≠nea. Ejemplo: Palabra1, Palabra2, Palabra3..."></textarea>
    </div>
    
    <button onclick="startGame()">Comenzar</button>
</div>

<!-- GRID -->
<div id="gridView" class="card hidden">
    <h2>Selecciona tu jugador</h2>
    <div id="grid" class="grid"></div>
</div>

<!-- JUGADOR -->
<div id="playerView" class="card hidden">
    <div id="playerTitle" class="big"></div>

    <div class="flip-container">
        <div id="flipCard" class="flip-card">
            <div class="flip-face front">‚ùì</div>
            <div class="flip-face back" id="roleBack"></div>
        </div>
    </div>

    <button id="showBtn" onclick="showRole()">Ver palabra</button>
    <button id="nextBtn" class="hidden" onclick="closePlayer()">Siguiente</button>
</div>

<!-- FINAL -->
<div id="end" class="card hidden">
    <h2>üí¨ Discusi√≥n</h2>
    <button onclick="revealImpostors()">Revelar impostor(es) y perdido(s)</button>
</div>

<!-- FIRMA -->
<div class="signature">Hecho por ssaauull123</div>

<script>
const categories={
    marcas:["Nike","Adidas","Apple","Samsung","Sony","LG","Puma","Reebok","Gucci","Prada","Ferrari","BMW","Audi","Toyota","Coca-Cola"],
    paises:["Argentina","Espa√±a","Brasil","M√©xico","Italia","Francia","Alemania","Chile","Per√∫","Colombia","Jap√≥n","China","Canad√°","Egipto","Australia"],
    objetos:["Silla","Mesa","Tel√©fono","Ordenador","Reloj","Mochila","Libro","L√°mpara","Cuchara","Tijeras","Televisi√≥n","Botella","Teclado","Auriculares","Espejo"],
    animales:["Le√≥n","Tigre","Elefante","Jirafa","Cocodrilo","Lobo","Oso","Mono","√Åguila","Tibur√≥n","Delf√≠n","Ping√ºino","Cebra","Rinoceronte","Serpiente"],
    comidas:["Pizza","Hamburguesa","Tacos","Sushi","Paella","Pasta","Empanada","Asado","Ramen","Ensalada","Lasagna","Kebab","Burrito","Milanesa","Hot Dog"],
    profesiones:["Doctor","Ingeniero","Profesor","Abogado","Arquitecto","Enfermero","Programador","Dise√±ador","Chef","Mec√°nico","Electricista","Periodista","Psic√≥logo","Veterinario","Contador"],
    ciudades:["Par√≠s","Londres","Roma","Tokio","Nueva York","Madrid","Barcelona","Berl√≠n","Lisboa","Mosc√∫","Miami","Dub√°i","S√≠dney","Atenas","√Åmsterdam"],
    videojuegos:["Mario","Zelda","Minecraft","Fortnite","PUBG","GTA","FIFA","Call of Duty","Overwatch","League of Legends","Dota 2","CS:GO","Rocket League","Among Us","Tetris","Pac-Man","Sonic","Pok√©mon","Final Fantasy","World of Warcraft"]
};

let roles=[],impostorsArr=[],lostArr=[],opened=[],total=0,current=0,playerNames=[],wordList=[];

function updatePlayerNameInputs(){
    const numPlayers = Math.min(Math.max(parseInt(document.getElementById('players').value) || 6, 3), 30);
    document.getElementById('players').value = numPlayers;
    const container = document.getElementById('playerNamesContainer');
    container.innerHTML = '';
    
    for(let i = 0; i < numPlayers; i++){
        const div = document.createElement('div');
        div.innerHTML = `
            <label>Jugador ${i+1}</label>
            <input type="text" class="player-name-input" id="playerName${i}" placeholder="Nombre del jugador ${i+1}" value="Jugador ${i+1}">
        `;
        container.appendChild(div);
    }
    
    // Update max values for impostors and lost
    const impostorsInput = document.getElementById('impostors');
    const lostInput = document.getElementById('lost');
    impostorsInput.max = numPlayers - 1;
    lostInput.max = numPlayers - 1;
    if(parseInt(impostorsInput.value) >= numPlayers) impostorsInput.value = 1;
    if(parseInt(lostInput.value) > numPlayers) lostInput.value = 0;
    
    validateConfig();
}

function validateConfig(){
    const totalPlayers = parseInt(document.getElementById('players').value) || 6;
    const impostors = parseInt(document.getElementById('impostors').value) || 1;
    const lost = parseInt(document.getElementById('lost').value) || 0;
    
    // Ensure impostors + lost doesn't exceed total players
    if(impostors + lost > totalPlayers){
        if(impostors > totalPlayers - lost){
            document.getElementById('impostors').value = Math.max(1, totalPlayers - lost);
        }
        if(lost > totalPlayers - impostors){
            document.getElementById('lost').value = totalPlayers - impostors;
        }
    }
    
    // Ensure at least 1 impostor and total players > impostors + lost
    if(impostors >= totalPlayers){
        document.getElementById('impostors').value = totalPlayers - 1;
    }
}

function toggleCustomInput(){
    const categorySelect = document.getElementById('category');
    const customContainer = document.getElementById('customCategoryContainer');
    
    if(categorySelect.value === 'custom'){
        customContainer.classList.remove('hidden');
    } else {
        customContainer.classList.add('hidden');
    }
}

// Initialize player name inputs on load
window.onload = function(){
    updatePlayerNameInputs();
    document.getElementById('players').addEventListener('input', function(){
        // Ensure minimum 3 players
        if(this.value < 3) this.value = 3;
        if(this.value > 30) this.value = 30;
        updatePlayerNameInputs();
    });
    
    document.getElementById('impostors').addEventListener('input', validateConfig);
    document.getElementById('lost').addEventListener('input', validateConfig);
};

function goStep2(){
    total = parseInt(document.getElementById('players').value);
    const impostorsCount = parseInt(document.getElementById('impostors').value);
    const lostCount = parseInt(document.getElementById('lost').value);
    
    if(impostorsCount >= total){
        alert("Impostores inv√°lidos");
        return;
    }
    
    if(impostorsCount + lostCount > total){
        alert("El n√∫mero total de impostores y perdidos no puede exceder el n√∫mero de jugadores");
        return;
    }
    
    // Collect player names
    playerNames = [];
    for(let i = 0; i < total; i++){
        const nameInput = document.getElementById(`playerName${i}`);
        playerNames.push(nameInput.value.trim() || `Jugador ${i+1}`);
    }
    
    step1.classList.add("hidden");
    step2.classList.remove("hidden");
}

function getCustomWords(){
    const customWordsInput = document.getElementById('customWords').value;
    if(!customWordsInput.trim()){
        return [];
    }
    
    // Split by commas, newlines, or multiple spaces
    let words = customWordsInput.split(/[,;\n\r\s]+/).filter(word => word.trim() !== '');
    
    // Remove duplicates and trim whitespace
    words = [...new Set(words.map(word => word.trim()))];
    
    return words;
}

function startGame(){
    const categorySelect = document.getElementById('category').value;
    
    if(categorySelect === 'custom'){
        const customWords = getCustomWords();
        if(customWords.length < 1){
            alert("Por favor, ingresa al menos una palabra para la categor√≠a personalizada.");
            return;
        }
        wordList = customWords;
    } else {
        wordList = categories[categorySelect];
    }
    
    // Select a random word from the list for the main word
    const mainWord = wordList[Math.floor(Math.random() * wordList.length)];
    
    roles = Array(total).fill(mainWord);
    impostorsArr = [];
    lostArr = [];
    opened = Array(total).fill(false);

    // Assign impostors
    while(impostorsArr.length < parseInt(document.getElementById('impostors').value)){
        let r = Math.floor(Math.random()*total);
        if(!impostorsArr.includes(r) && !lostArr.includes(r)){
            impostorsArr.push(r);
            roles[r] = "IMPOSTOR";
        }
    }
    
    // Assign lost players with different words from the same category
    while(lostArr.length < parseInt(document.getElementById('lost').value)){
        let r = Math.floor(Math.random()*total);
        if(!impostorsArr.includes(r) && !lostArr.includes(r)){
            lostArr.push(r);
            // Select a different word from the same category for lost players
            let differentWord;
            do {
                differentWord = wordList[Math.floor(Math.random() * wordList.length)];
            } while (differentWord === mainWord);
            roles[r] = differentWord;
        }
    }

    step2.classList.add("hidden");
    gridView.classList.remove("hidden");
    renderGrid();
}

function renderGrid(){
    grid.innerHTML = "";
    opened.forEach((v,i) => {
        const d = document.createElement("div");
        d.className = "player-box" + (v ? " ready" : "");
        d.innerHTML = v ? `${playerNames[i]}<br>Listo ‚úÖ` : playerNames[i];
        if(!v) d.onclick = () => openPlayer(i);
        grid.appendChild(d);
    });

    if(opened.every(v => v)){
        gridView.classList.add("hidden");
        end.classList.remove("hidden");
    }
}

function openPlayer(i){
    current = i;
    gridView.classList.add("hidden");
    playerView.classList.remove("hidden");
    playerTitle.innerText = playerNames[i];
    flipCard.classList.remove("flipped");
    roleBack.innerHTML = "";
    showBtn.classList.remove("hidden");
    nextBtn.classList.add("hidden");
}

function showRole(){
    if(roles[current] === "IMPOSTOR"){
        roleBack.innerHTML = `<span class="impostor">‚ùå IMPOSTOR</span>`;
    } else {
        // For both regular players and lost players, show their word
        roleBack.innerHTML = `<span class="word">‚úÖ ${roles[current]}</span>`;
    }
    flipCard.classList.add("flipped");
    showBtn.classList.add("hidden");
    nextBtn.classList.remove("hidden");
}

function closePlayer(){
    opened[current] = true;
    playerView.classList.add("hidden");
    gridView.classList.remove("hidden");
    renderGrid();
}

function revealImpostors(){
    end.innerHTML = "<h2>üïµÔ∏è Resultados</h2>";
    
    // Show impostors
    if(impostorsArr.length > 0){
        end.innerHTML += "<h3>Impostor(es):</h3>";
        impostorsArr.forEach(i => {
            end.innerHTML += `<p class="impostor big">${playerNames[i]}</p>`;
        });
    }
    
    // Show lost players
    if(lostArr.length > 0){
        end.innerHTML += "<h3>Perdido(s):</h3>";
        lostArr.forEach(i => {
            end.innerHTML += `<p class="lost big">${playerNames[i]}</p>`;
        });
    }
}
</script>

</body>
</html>
